@model IEnumerable<WebApplication3.Models.Court>

@{
    Layout = null;
    var currentFilter = ViewData["CurrentFilter"] as string;
}

<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Quản lý Sân tập - The Hunter</title>

    <link rel="stylesheet" href="~/css/Court.css" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        /* Tinh chỉnh bổ sung cho các form xử lý nhanh */
        .quick-input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            font-size: 13px;
            margin-bottom: 8px;
            outline: none;
        }

            .quick-input:focus {
                border-color: #2962ff;
            }

        .btn-action-primary {
            background: #2962ff;
            color: white;
            border: none;
            border-radius: 6px;
            padding: 8px 12px;
            font-weight: 600;
            font-size: 13px;
            cursor: pointer;
        }

        .btn-action-danger {
            background: #fee2e2;
            color: #ef4444;
            border: 1px solid #fecaca;
            border-radius: 6px;
            padding: 10px;
            font-weight: 700;
            width: 100%;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="main-layout">
        <aside class="sidebar">
            <div style="padding: 24px; text-align: center;">
                <div style="font-size: 18px; font-weight: 800; color: #1e293b;">Quản lý Sân Tập</div>
                <div style="font-size: 16px; color: #2962ff; font-weight: 600;">The Hunter</div>
            </div>

            <nav class="sidebar-menu">
                <p style="font-size: 12px; color: var(--text-muted); padding: 0 16px; margin-bottom: 8px;">Menu quản lý</p>

                <a href="#" class="menu-item">
                    <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <rect x="3" y="3" width="7" height="7"></rect>
                        <rect x="14" y="3" width="7" height="7"></rect>
                        <rect x="14" y="14" width="7" height="7"></rect>
                        <rect x="3" y="14" width="7" height="7"></rect>
                    </svg>
                    Dashboard
                </a>

                <a asp-controller="Court" asp-action="Index" class="menu-item active">
                    <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                        <line x1="16" y1="2" x2="16" y2="6"></line>
                        <line x1="8" y1="2" x2="8" y2="6"></line>
                        <line x1="3" y1="10" x2="21" y2="10"></line>
                    </svg>
                    Quản lý sân
                </a>

                <a asp-controller="Staff" asp-action="Index" class="menu-item">
                    <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                        <circle cx="9" cy="7" r="4"></circle>
                        <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                        <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                    </svg>
                    Quản lý nhân sự
                </a>

                <a asp-controller="Booking" asp-action="Index" class="menu-item">
                    <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <path d="M15 5v2m0 4v2m0 4v2M5 5a2 2 0 00-2 2v3a2 2 0 110 4v3a2 2 0 002 2h14a2 2 0 002-2v-3a2 2 0 110-4V7a2 2 0 00-2-2H5z"></path>
                    </svg>
                    Đăng ký vé
                </a>

                <a href="#" class="menu-item">
                    <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <path d="M12 9v3m0 0v3m0-3h3m-3 0H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    Yêu cầu thêm
                </a>

                <a href="#" class="menu-item">
                    <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <path d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"></path>
                    </svg>
                    Kho hàng
                </a>
            </nav>
        </aside>

        <main class="content-area">
            <div class="header-flex" style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 32px;">
                <div>
                    <h1 style="margin: 0; font-size: 32px; font-weight: 700; color: #1e293b;">Quản lý sân</h1>
                    <p style="color: #64748b; margin-top: 4px;">Trạng thái thời gian thực của hệ thống sân tập</p>
                </div>
                <div style="display: flex; align-items: center; gap: 16px;">
                    <div class="status-summary">
                        <div class="summary-item"><span class="dot" style="background:#22c55e"></span> Trống: @ViewBag.AvailableCount</div>
                        <div class="summary-item"><span class="dot" style="background:#ef4444"></span> Đang dùng: @ViewBag.OccupiedCount</div>
                        <div class="summary-item"><span class="dot" style="background:#f59e0b"></span> Bảo trì: @ViewBag.MaintenanceCount</div>
                    </div>
                    <a asp-action="Create" class="btn-submit" style="text-decoration:none">+ Thêm sân mới</a>
                </div>
            </div>

            <div class="court-grid">
                @foreach (var item in Model)
                {
                    <div class="court-card">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <h5 style="margin: 0; font-size: 20px; font-weight: 700; color: #1e293b;">@item.Name</h5>
                            <span class="status-badge @(item.Status == WebApplication3.Models.CourtStatus.Available ? "badge-available" : (item.Status == WebApplication3.Models.CourtStatus.Occupied ? "badge-occupied" : "badge-maintenance"))">
                                <span class="dot"></span> @item.Status
                            </span>
                        </div>

                        <div class="info-box" style="min-height: 150px; background: #f8fafc; border: 1px solid #f1f5f9; padding: 16px; border-radius: 10px;">
                            @if (item.Status == WebApplication3.Models.CourtStatus.Occupied)
                            {
                                <div style="margin-bottom: 12px;">
                                    <div style="font-size: 12px; color: #64748b; font-weight: 600; text-transform: uppercase;">Khách hàng</div>
                                    <div style="font-weight: 700; font-size: 16px; color: #1e293b;">@item.CurrentCustomerName</div>
                                    <div style="font-size: 12px; color: #64748b; margin-top: 8px;">BẮT ĐẦU: @item.OccupiedSince?.ToString("HH:mm")</div>
                                    <div style="font-size: 12px; color: #64748b; margin-top: 8px;">KẾT THÚC: @item.OccupiedUntil?.ToString("HH:mm")</div> <!-- Thêm dòng này -->
                                </div>

                                <form asp-action="CheckOut" method="post">
                                    <input type="hidden" name="id" value="@item.Id" />
                                    <button type="submit" class="btn-action-danger" onclick="return confirm('Xác nhận trả sân?')">
                                        Trả sân & Thanh toán
                                    </button>
                                </form>
                            }
                            else if (item.Status == WebApplication3.Models.CourtStatus.Available)
                            {
                                <div style="text-align: center; color: #22c55e; font-weight: 700; margin-bottom: 12px;">Sẵn sàng đón khách</div>

                                <form asp-action="CheckIn" method="post">
                                    <input type="hidden" name="id" value="@item.Id" />
                                    <input type="text" name="customerName" placeholder="Tên khách..." required class="quick-input" />
                                    <div style="display: flex; gap: 8px;">
                                        <select name="hours" class="quick-input" style="margin-bottom: 0;">
                                            <option value="1">1 Giờ</option>
                                            <option value="2">2 Giờ</option>
                                            <option value="3">3 Giờ</option>
                                        </select>
                                        <button type="submit" class="btn-action-primary">Nhận</button>
                                    </div>
                                </form>
                            }
                            else
                            {
                                <div style="text-align: center; padding: 30px 0;">
                                    <div style="color: #f59e0b; font-weight: 700;">ĐANG BẢO TRÌ</div>
                                    <p style="font-size: 12px; color: #94a3b8; margin-top: 4px;">Tạm ngưng phục vụ</p>
                                </div>
                            }
                        </div>

                        <div style="display: flex; gap: 12px; margin-top: 16px; padding-top: 12px; border-top: 1px solid #f1f5f9;">
                            <a asp-action="Edit" asp-route-id="@item.Id" style="color: #2962ff; text-decoration: none; font-weight: 600; font-size: 14px;">Sửa</a>

                            @if (item.Status != WebApplication3.Models.CourtStatus.Occupied)
                            {
                                <form asp-action="ToggleMaintenance" method="post" style="flex: 1; text-align: center;">
                                    <input type="hidden" name="id" value="@item.Id" />
                                    <button type="submit" style="background:none; border:none; color:#64748b; font-weight:600; cursor:pointer; font-size:14px;">
                                        @if (item.Status == WebApplication3.Models.CourtStatus.Maintenance)
                                        {
                                            <text>✅ Hoàn thành bảo trì</text>
                                        }
                                        else
                                        {
                                            <text>🛠 Đặt bảo trì</text>
                                        }
                                    </button>
                                </form>
                            }

                            <a asp-action="Delete" asp-route-id="@item.Id" style="color: #ef4444; text-decoration: none; font-weight: 600; font-size: 14px;" onclick="return confirm('Xóa sân này?')">Xóa</a>
                        </div>
                    </div>
                }
            </div>
        </main>
    </div>

</body>
</html>